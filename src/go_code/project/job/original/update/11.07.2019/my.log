[0;32masciinema: recording asciicast to ./CLI/CLI[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
# start[?1034hbash-3.2$ # start container image with SCONE CLI
bash-3.2$ docker run -it -v $HOME/.ssh:/root/.xssh  sconecuratedimages/sconecli
/ # [6n/ # [J
/ # [6n
/ # [6n#ensure that we have ssh credentials to log into servers sgx2, sgx3 and sgx4
/ # [6ncp -f $HOME/.xssh/* $HOME/.ssh/
cp: can't create '/root/.ssh/id_rsa': No such file or directory
cp: can't create '/root/.ssh/id_rsa.pub': No such file or directory
cp: can't create '/root/.ssh/known_hosts': No such file or directory
/ # [6n
/ # [6n
/ # [6n#install patched driver and patched docker engine and start a new swarm
/ # [6nscone host install --verbose --name sgx2 --as-manager
ssh: Could not resolve hostname sgx2: Name does not resolve
[31mfatal:  'check_sudo: password-less sudo required on host 'sgx2' but not permitted - or, ssh to host failed. (stack=352 661 0)' [00m (Line numer: '352')
/ # [6n
/ # [6n
/ # [6n# check if sgx2 is properly installed
/ # [6nscone host check --verbose --name sgx2
ssh: Could not resolve hostname sgx2: Name does not resolve
[31mfatal:  'check_sudo: password-less sudo required on host 'sgx2' but not permitted - or, ssh to host failed. (stack=352 696 0)' [00m (Line numer: '352')
/ # [6n
/ # [6n
/ # [6n# install sgx3 - does not support systemctl
/ # [6nscone host install --verbose --name sgx3  --join sgx2
ssh: Could not resolve hostname sgx3: Name does not resolve
[31mfatal:  'check_sudo: password-less sudo required on host 'sgx3' but not permitted - or, ssh to host failed. (stack=352 661 0)' [00m (Line numer: '352')
/ # [6n
/ # [6nscone host check --verbose --name sgx3
ssh: Could not resolve hostname sgx3: Name does not resolve
[31mfatal:  'check_sudo: password-less sudo required on host 'sgx3' but not permitted - or, ssh to host failed. (stack=352 696 0)' [00m (Line numer: '352')
/ # [6n
/ # [6n
/ # [6n# install sgx4 - sgx4 has an unpatched driver that is in use and hence, cann
ot be offloaded; this results in a warning
/ # [6nscone host install --verbose --name sgx4  --join sgx2
ssh: Could not resolve hostname sgx4: Name does not resolve
[31mfatal:  'check_sudo: password-less sudo required on host 'sgx4' but not permitted - or, ssh to host failed. (stack=352 661 0)' [00m (Line numer: '352')
/ # [6n
/ # [6n# now check the status of sgx4
/ # [6nscone host check --verbose --name sgx4
ssh: Could not resolve hostname sgx4: Name does not resolve
[31mfatal:  'check_sudo: password-less sudo required on host 'sgx4' but not permitted - or, ssh to host failed. (stack=352 696 0)' [00m (Line numer: '352')
/ # [6n
/ # [6n# show which nodes are participating in the swarm
/ # [6nssh sgx2 sudo docker node ls
ssh: Could not resolve hostname sgx2: Name does not resolve
/ # [6n
/ # [6nexit
bash-3.2$ exit
exit
[0;32masciinema: recording finished[0m
[0;32masciinema: asciicast saved to ./CLI/CLI[0m
[0;32masciinema: recording asciicast to ./FLASK/FLASK[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m

[?1034hbash-3.2$ 
bash-3.2$ 
bash-3.2$ # start our curated SCONE Python container image
bash-3.2$ sudo docker run --device=/dev/isgx -it -v "$PWD":/usr/src/myapp -w /us r/src/myapp sconecuratedimages/crosscompilers:python27 bash
Password:
Sorry, try again.
Password:
Sorry, try again.
Password:
sudo: 3 incorrect password attempts
bash-3.2$ pip install -r requirements.txt
[33mDEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7.[0m
[31mERROR: Could not open requirements file: [Errno 2] No such file or directory: 'requirements.txt'[0m
bash-3.2$ 
bash-3.2$ SCONE_MODE=HW SCONE_ALLOW_DLOPEN=2 SCONE_ALPINE=1 SCONE_VERSION=1 pyth on app.py
/usr/local/Cellar/python@2/2.7.15_1/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python: can't open file 'app.py': [Errno 2] No such file or directory
bash-3.2$ 
bash-3.2$ exit()
> exit
bash: syntax error near unexpected token `exit'
bash-3.2$ exit
exit
[0;32masciinema: recording finished[0m
[0;32masciinema: asciicast saved to ./FLASK/FLASK[0m
[0;32masciinema: recording asciicast to ./FSPF/FSPF[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
docke[?1034hbash-3.2$ docker run -it -v $PWD:/mnt sconecuratedimages/crosscompilers:scone
]0;root@a9e2c63b42e6: /root@a9e2c63b42e6:/# 
]0;root@a9e2c63b42e6: /root@a9e2c63b42e6:/# mkdir -p /example
]0;root@a9e2c63b42e6: /root@a9e2c63b42e6:/# mkdir -p /mnt/authenticated/
]0;root@a9e2c63b42e6: /root@a9e2c63b42e6:/# [Kmkdir -p /mnt/encrypted/
]0;root@a9e2c63b42e6: /root@a9e2c63b42e6:/# cd /example
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# mkdir -p .original
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# 
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# scone fspf create fspf.pb
Created empty file system protection file in fspf.pb. AES-GCM tag: db47d7a9d6f7315df7e1599432a7b8fc
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# scone fspf create authenticated.pb
Created empty file system protection file in authenticated.pb. AES-GCM tag: 5b98434bc8526c605ab7a2d6d9e24b45
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# [Kscone fspf create encrypted.pb
Created empty file system protection file in encrypted.pb. AES-GCM tag: 25b710a324c056218b05a869d23db1cc
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# 
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# # add protection regions
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# scone fspf addr fspf.pb / -e --ephemeral
Added region / to file system protection file fspf.pb new AES-GCM tag: 13e2ca80dedbc0ec4e247625de5b973d
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# [Kscone fspf addr authenticated.pb /mnt/authenticated  -a --kernel /mnt/authenticated
Added region /mnt/authenticated to file system protection file authenticated.pb new AES-GCM tag: 1965ec5535a6cda729148743fda56973
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# [Kscone fspf addr encrypted.pb /mnt/encrypted -e --ker nel /mnt/encrypted
Added region /mnt/encrypted to file system protection file encrypted.pb new AES-GCM tag: 034ca43b79d1b75916a36d15a0fdd65f
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# [K
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# # add files
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# 
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# # enclave program should expect the files (directori es) found by the client in ./original in /mnt/authenticated
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# [Kscone fspf addf authenticated.pb /mnt/authenticated  ./original
Added files to file system protection file authenticated.pb new AES-GCM tag: f3d646d7fab4018438c7ef71730160b6
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# [K
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# # enclave program should expect the files (directori es) found by the client in ./original in encrypted form in /mnt/encrypted
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# [K# the client will write the encrypted files to ./mnt /encrypted
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# [Kscone fspf addf encrypted.pb /mnt/encrypted ./origin al ./mnt/encrypted
Added files to file system protection file encrypted.pb new AES-GCM tag: 508dc4dd09a7dea8d03097e0a3a8c3a3
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# [Kencrypted_key=`scone fspf encrypt encrypted.pb | awk  '{print $11}'`
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# [K
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# echo "encrypted.pb key: ${encrypted_key}"
encrypted.pb key: 11ccb2ef7f2735045d5db98d3e7de0199943340a34f88cb16b83fe5306a39414
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# [Kscone fspf addfspf fspf.pb authenticated.pb
Added sub fspf authenticated.pb to file system protection file fspf.pb new AES-GCM tag: ba3103a22ab14acd4edba2797ad867fd
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# [Kscone fspf addfspf fspf.pb encrypted.pb ${encrypted_ key}
Added sub fspf encrypted.pb to file system protection file fspf.pb new AES-GCM tag: 404d5888bdbcaef19145aa792fcda6fe
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# [Kcat > example.c << EOF
> #include <stdio.h>
> 
> int main() {
>     FILE *fp = fopen("/mnt/authenticated/hello", "w");
>     fprintf(fp, "hello world\n");
>     fclose(fp);
> 
>     fp = fopen("/mnt/encrypted/hello", "w");
>     fprintf(fp, "hello world\n");
>     fclose(fp);
> }
> EOF
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# scone gcc example.c -o sgxex
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# cat > /etc/sgx-musl.conf << EOF
> Q 4
> e -1 0 0
> s -1 0 0
> e -1 1 0
> s -1 1 0
> e -1 2 0
> s -1 2 0
> e -1 3 0
> s -1 3 0
> EOF
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# SCONE_FSPF=fspf.pb ./sgxex
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# cat /mnt/authenticated/hello
hello world
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# cat /mnt/encrypted/hello 
ýymš„ÃÑ·_X0]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# cat > cat.c << EOF
> #include <stdio.h>
> 
> int main() {
>     char buf[80];
>     FILE *fp = fopen("/mnt/authenticated/hello", "r");
>     fgets(buf, sizeof(buf), fp);
>     fclose(fp);
>     printf("read: '%s'\n", buf);
> 
>     fp = fopen("/mnt/encrypted/hello", "r");
>     fgets(buf, sizeof(buf), fp);
>     fclose(fp);
>     printf("read: '%s'\n", buf);
> }
> EOF
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# 
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# scone gcc cat.c -o native_cat
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# ./native_cat
read: 'hello world
'
read: 'ýymš„ÃÑ·_X0'
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# scone gcc cat.c -o sgxcat
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# SCONE_FSPF=fspf.pb ./sgxcat
read: 'hello world
'
read: 'hello world
'
]0;root@a9e2c63b42e6: /exampleroot@a9e2c63b42e6:/example# exit
exit
bash-3.2$ exit
exit
[0;32masciinema: recording finished[0m
[0;32masciinema: asciicast saved to ./FSPF/FSPF[0m
[0;32masciinema: recording asciicast to ./GO/GO[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
dock[?1034hbash-3.2$ docker pull sconecuratedimages/crosscompilers:scone
Error response from daemon: pull access denied for sconecuratedimages/crosscompilers, repository does not exist or may require 'docker login'
bash-3.2$ 
bash-3.2$ #docker run -it sconecuratedimages/crosscompilers:scone
bash-3.2$ docker run --cap-add SYS_PTRACE -it -p 9090:8080 -v "$PWD"/EXAMPLE:/us r/src/myapp -w /usr/src/myapp  sconecuratedimages/crosscompilers:scone
]0;root@702c803056cc: /usr/src/myapproot@702c803056cc:/usr/src/myapp# [K]0;root@702c803056cc: /usr/src/myapproot@702c803056cc:/usr/src/myapp# 
]0;root@702c803056cc: /usr/src/myapproot@702c803056cc:/usr/src/myapp# cat > /etc/sgx-musl.conf << EOF
> Q 1
> e 0 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> s 1 0 0
> EOF
]0;root@702c803056cc: /usr/src/myapproot@702c803056cc:/usr/src/myapp# cat > web-srv.go << EOF
> 
> package main
> 
> import (
>     "fmt"
>     "net/http"
> )
> 
> func handler(w http.ResponseWriter, r *http.Request) {
>     fmt.Fprintf(w, "Hi there, I love %s!", r.URL.Path[1:])
> }
> 
> func main() {
>     http.HandleFunc("/", handler)
>     http.ListenAndServe(":8080", nil)
> }
> EOF
]0;root@702c803056cc: /usr/src/myapproot@702c803056cc:/usr/src/myapp# 
]0;root@702c803056cc: /usr/src/myapproot@702c803056cc:/usr/src/myapp# SCONE_HEAP=1G scone-gccgo web-srv.go -O3 -o we b-srv-go -g

]0;root@702c803056cc: /usr/src/myapproot@702c803056cc:/usr/src/myapp# [K
]0;root@702c803056cc: /usr/src/myapproot@702c803056cc:/usr/src/myapp# SCONE_MODE=HW SCONE_ALLOW_DLOPEN=2 SCONE_VERSI ON=1 ./web-srv-go
[SCONE|ERROR] ./tools/starter-exec.c:990:main(): Could not create enclave: Error opening SGX device
]0;root@702c803056cc: /usr/src/myapproot@702c803056cc:/usr/src/myapp# [KSCONE_MODE=HW SCONE_VERSION=1 ./web-srv-go
[SCONE|ERROR] ./tools/starter-exec.c:990:main(): Could not create enclave: Error opening SGX device
]0;root@702c803056cc: /usr/src/myapproot@702c803056cc:/usr/src/myapp# [K#container:
]0;root@702c803056cc: /usr/src/myapproot@702c803056cc:/usr/src/myapp# scone-gdb ./web-srv-go
GNU gdb (Ubuntu 8.0.1-0ubuntu1) 8.0.1
Copyright (C) 2017 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Source directories searched: /opt/scone/scone-gdb/gdb-sgxmusl-plugin:$cdir:$cwd
Setting environment variable "LD_PRELOAD" to null value.
Reading symbols from ./web-srv-go...done.
[SCONE] Initializing...
(gdb) set environment SCONE_ALLOW_DLOPEN=2
(gdb) set environment SCONE_VERSION=1 
(gdb) set environment SCONE_MODE=HW
(gdb) set environment SCONE_ALPINE=1
(gdb) 
(gdb) handle SIGILL nostop pass
Signal        Stop	Print	Pass to program	Description
SIGILL        No	Yes	Yes		Illegal instruction
(gdb) run 
Starting program: /usr/src/myapp/web-srv-go 
warning: Error disabling address space randomization: Operation not permitted
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
[SCONE|ERROR] ./tools/starter-exec.c:990:main(): Could not create enclave: Error opening SGX device
[Inferior 1 (process 66) exited with code 01]
(gdb) 
(gdb) # symbols?!?
(gdb) quit
]0;root@702c803056cc: /usr/src/myapproot@702c803056cc:/usr/src/myapp# exit
exit
bash-3.2$ #exit
bash-3.2$ exit
exit
[0;32masciinema: recording finished[0m
[0;32masciinema: asciicast saved to ./GO/GO[0m
[0;32masciinema: recording asciicast to ./PYTHON/PYTHON[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
# sta[?1034hbash-3.2$ # start our curated SCONE Python container image
bash-3.2$ sudo docker run --device=/dev/isgx -it sconecuratedimages/crosscompile rs:python27 bash
Password:
Sorry, try again.
Password:
Sorry, try again.
Password:
sudo: 3 incorrect password attempts
bash-3.2$ 
bash-3.2$ # start python inside of an enclave and allow dynamic loading of libra ries
bash-3.2$ # and use example from https://pypi.python.org/pypi/python-chess
bash-3.2$ 
bash-3.2$ SCONE_MODE=HW SCONE_ALLOW_DLOPEN=2 SCONE_ALPINE=1 SCONE_VERSION=1 pyth on
Python 2.7.15 (default, Nov 27 2018, 21:24:58) 
[GCC 4.2.1 Compatible Apple LLVM 10.0.0 (clang-1000.11.45.5)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> 
>>> import chess
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ImportError: No module named chess
>>> board = chess.Board()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'chess' is not defined
>>> board.legal_moves
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'board' is not defined
>>> chess.Move.from_uci("a8a1") in board.legal_moves
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'chess' is not defined
>>> board.push_san("e4")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'board' is not defined
>>> board.push_san("e5")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'board' is not defined
>>> board.push_san("Qh5")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'board' is not defined
>>> board.push_san("Nc6")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'board' is not defined
>>> board.push_san("Bc4")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'board' is not defined
>>> board.push_san("Nf6")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'board' is not defined
>>> board.push_san("Qxf7")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'board' is not defined
>>> board.is_checkmate()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'board' is not defined
>>> board
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'board' is not defined
>>> 
>>> exit()
bash-3.2$ exit
exit
[0;32masciinema: recording finished[0m
[0;32masciinema: asciicast saved to ./PYTHON/PYTHON[0m
[0;32masciinema: recording asciicast to ./SWARM/SWARM[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
# sta[?1034hbash-3.2$ # start container image with SCONE CLI
bash-3.2$ docker run -it -v $HOME/.ssh:/root/.xssh  sconecuratedimages/sconecli
/ # [6n/ # [J
/ # [6n#ensure that we have ssh credentials to log into servers sgx2 and sgx4
/ # [6ncp -f $HOME/.xssh/* $HOME/.ssh/
cp: can't create '/root/.ssh/id_rsa': No such file or directory
cp: can't create '/root/.ssh/id_rsa.pub': No such file or directory
cp: can't create '/root/.ssh/known_hosts': No such file or directory
/ # [6n
/ # [6n# check if all nodes of the swarm managed by host sgx2 are properly labeled
/ # [6nscone swarm check --verbose --manager sgx2
check_swarm
Verbose messages switched on.
- processing nodes of swarm managed by host sgx2
ssh: Could not resolve hostname sgx2: Name does not resolve
  found 0 ready nodes; purged 0 non-ready node(s).
- checking tags
Done.
/ # [6n
/ # [6n# list all nodes and their SCONE-relevant labels of the swarm managed by sgx
2
/ # [6nscone swarm ls --manager sgx2
ssh: Could not resolve hostname sgx2: Name does not resolve
[31mfatal:  'on_error_exit: scone swarm: unexpected error exit (command=scone swarm, script=/opt/scone/scone-cli/./scone-commons.sh, bash-cmd=L=$($prefix "sudo docker node ls --format '{{.ID}},{{.Hostname}},{{.Status}},{{.Availability}},{{.ManagerStatus}}' | sort -k 2  -t ','"), stack=1 215 0)' [00m (Line numer: '0')
/ # [6n
/ # [6nexit
bash-3.2$ exit
exit
[0;32masciinema: recording finished[0m
[0;32masciinema: asciicast saved to ./SWARM/SWARM[0m
